{
  "version": 3,
  "sources": ["../../../src/lib/app-type/abstract.ts"],
  "sourcesContent": ["import { AwtrixLight } from '../../main';\nimport { DefaultApp } from '../adapter-config';\nimport { AwtrixApi } from '../api';\n\nexport namespace AppType {\n    export abstract class AbstractApp {\n        protected apiClient: AwtrixApi.Client;\n        protected adapter: AwtrixLight;\n        private definition: DefaultApp;\n\n        public constructor(apiClient: AwtrixApi.Client, adapter: AwtrixLight, definition: DefaultApp) {\n            this.apiClient = apiClient;\n            this.adapter = adapter;\n            this.definition = definition;\n\n            adapter.on('stateChange', this.onStateChange.bind(this));\n            adapter.on('objectChange', this.onObjectChange.bind(this));\n        }\n\n        public getName(): string {\n            return this.definition.name;\n        }\n\n        public async init(): Promise<void> {\n            \n        }\n\n        public async createObjects(prefix: string): Promise<void> {\n            const appName = this.getName();\n\n            await this.adapter.setObjectNotExistsAsync(`${prefix}.${appName}.visible`, {\n                type: 'state',\n                common: {\n                    name: {\n                        en: 'Visible',\n                        de: 'Sichtbar',\n                        ru: '\u0412\u0438\u0434\u0438\u043C\u044B\u0439',\n                        pt: 'Vis\u00EDvel',\n                        nl: 'Vertaling',\n                        fr: 'Visible',\n                        it: 'Visibile',\n                        es: 'Visible',\n                        pl: 'Widoczny',\n                        //uk: '\u0412\u0438\u0431\u0440\u0430\u043D\u0456',\n                        'zh-cn': '\u4E0D\u53EF\u6297\u8FA9',\n                    },\n                    type: 'boolean',\n                    role: 'switch.enable',\n                    read: true,\n                    write: true,\n                    def: true,\n                },\n                native: {\n                    name: appName,\n                },\n            });\n        }\n\n        public async unloadAsync(): Promise<void> {\n            if (this.adapter.config.removeAppsOnStop) {\n                this.adapter.log.info(`[onUnload] Deleting app on awtrix light with name \"${this.definition.name}\"`);\n\n                try {\n                    await this.apiClient.removeAppAsync(this.definition.name).catch((error) => {\n                        this.adapter.log.warn(`Unable to remove unknown app \"${this.definition.name}\": ${error}`);\n                    });\n                } catch (error) {\n                    this.adapter.log.error(`[onUnload] Unable to delete app ${this.definition.name}: ${error}`);\n                }\n            }\n        }\n\n        private async onStateChange(id: string, state: ioBroker.State | null | undefined): Promise<void> {\n            const idNoNamespace = this.adapter.removeNamespace(id);\n            const appName = this.getName();\n\n            // Handle default states for all apps\n            if (id && state && !state.ack) {\n                if (idNoNamespace == `apps.${appName}.visible`) {\n                    this.adapter.log.debug(`changing visibility of app ${appName} to ${state.val}`);\n\n                    await this.adapter.setStateAsync(idNoNamespace, { val: state.val, ack: true, c: 'onStateChange' });\n                }\n            }\n\n            await this.stateChanged(id, state);\n        }\n\n        protected async stateChanged(id: string, state: ioBroker.State | null | undefined): Promise<void> {\n            // override\n        }\n\n        private async onObjectChange(id: string, obj: ioBroker.Object | null | undefined): Promise<void> {\n            await this.objectChanged(id, obj);\n        }\n\n        protected async objectChanged(id: string, obj: ioBroker.Object | null | undefined): Promise<void> {\n            // override\n        }\n    }\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAIO,IAAU;AAAA,CAAV,CAAUA,aAAV;AACI,QAAe,YAAY;AAAA,IAKvB,YAAY,WAA6B,SAAsB,YAAwB;AAC1F,WAAK,YAAY;AACjB,WAAK,UAAU;AACf,WAAK,aAAa;AAElB,cAAQ,GAAG,eAAe,KAAK,cAAc,KAAK,IAAI,CAAC;AACvD,cAAQ,GAAG,gBAAgB,KAAK,eAAe,KAAK,IAAI,CAAC;AAAA,IAC7D;AAAA,IAEO,UAAkB;AACrB,aAAO,KAAK,WAAW;AAAA,IAC3B;AAAA,IAEA,MAAa,OAAsB;AAAA,IAEnC;AAAA,IAEA,MAAa,cAAc,QAA+B;AACtD,YAAM,UAAU,KAAK,QAAQ;AAE7B,YAAM,KAAK,QAAQ,wBAAwB,GAAG,UAAU,mBAAmB;AAAA,QACvE,MAAM;AAAA,QACN,QAAQ;AAAA,UACJ,MAAM;AAAA,YACF,IAAI;AAAA,YACJ,IAAI;AAAA,YACJ,IAAI;AAAA,YACJ,IAAI;AAAA,YACJ,IAAI;AAAA,YACJ,IAAI;AAAA,YACJ,IAAI;AAAA,YACJ,IAAI;AAAA,YACJ,IAAI;AAAA,YAEJ,SAAS;AAAA,UACb;AAAA,UACA,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,OAAO;AAAA,UACP,KAAK;AAAA,QACT;AAAA,QACA,QAAQ;AAAA,UACJ,MAAM;AAAA,QACV;AAAA,MACJ,CAAC;AAAA,IACL;AAAA,IAEA,MAAa,cAA6B;AACtC,UAAI,KAAK,QAAQ,OAAO,kBAAkB;AACtC,aAAK,QAAQ,IAAI,KAAK,sDAAsD,KAAK,WAAW,OAAO;AAEnG,YAAI;AACA,gBAAM,KAAK,UAAU,eAAe,KAAK,WAAW,IAAI,EAAE,MAAM,CAAC,UAAU;AACvE,iBAAK,QAAQ,IAAI,KAAK,iCAAiC,KAAK,WAAW,UAAU,OAAO;AAAA,UAC5F,CAAC;AAAA,QACL,SAAS,OAAP;AACE,eAAK,QAAQ,IAAI,MAAM,mCAAmC,KAAK,WAAW,SAAS,OAAO;AAAA,QAC9F;AAAA,MACJ;AAAA,IACJ;AAAA,IAEA,MAAc,cAAc,IAAY,OAAyD;AAC7F,YAAM,gBAAgB,KAAK,QAAQ,gBAAgB,EAAE;AACrD,YAAM,UAAU,KAAK,QAAQ;AAG7B,UAAI,MAAM,SAAS,CAAC,MAAM,KAAK;AAC3B,YAAI,iBAAiB,QAAQ,mBAAmB;AAC5C,eAAK,QAAQ,IAAI,MAAM,8BAA8B,cAAc,MAAM,KAAK;AAE9E,gBAAM,KAAK,QAAQ,cAAc,eAAe,EAAE,KAAK,MAAM,KAAK,KAAK,MAAM,GAAG,gBAAgB,CAAC;AAAA,QACrG;AAAA,MACJ;AAEA,YAAM,KAAK,aAAa,IAAI,KAAK;AAAA,IACrC;AAAA,IAEA,MAAgB,aAAa,IAAY,OAAyD;AAAA,IAElG;AAAA,IAEA,MAAc,eAAe,IAAY,KAAwD;AAC7F,YAAM,KAAK,cAAc,IAAI,GAAG;AAAA,IACpC;AAAA,IAEA,MAAgB,cAAc,IAAY,KAAwD;AAAA,IAElG;AAAA,EACJ;AA9FO,EAAAA,SAAe;AAAA,GADT;",
  "names": ["AppType"]
}
